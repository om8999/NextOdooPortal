<!-- odoo_crud_project/index.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Odoo CRUD Example</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container my-5">
    <h1 class="mb-4 text-center">Odoo CRUD Example</h1>

        <!-- Add Product Section -->
        <div class="card mb-5 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">Add New Product</h4>
            </div>
            <div class="card-body">
                <div class="row g-3 align-items-center">
                    <div class="col-md-4">
                        <input type="text" id="name" class="form-control" placeholder="Name">
                    </div>
                    <div class="col-md-3">
                        <input type="number" id="price" class="form-control" placeholder="Price">
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="description" class="form-control" placeholder="Description">
                    </div>
                    <div class="col-md-1 d-grid">
                        <button onclick="createProduct()" class="btn btn-success">Add</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Table -->
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">
                <h4 class="mb-0">Products</h4>
            </div>
            <div class="card-body table-responsive">
                <table class="table table-bordered table-hover align-middle" id="productTable">
                    <thead class="table-dark">
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Description</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productList"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>


    <script>
        const API_URL = "http://localhost:8069/api/products"; // Odoo API endpoint
        
        function createEditableRow(p) {
        const row = document.createElement("tr");

        row.innerHTML = `
            <td>${p.id}</td>
            <td><input type="text" value="${p.name}" data-id="${p.id}" data-field="name"></td>
            <td><input type="number" value="${p.price}" data-id="${p.id}" data-field="price"></td>
            <td><input type="text" value="${p.description || ''}" data-id="${p.id}" data-field="description"></td>
            <td>
                <button onclick="deleteProduct(${p.id})">Delete</button>
            </td>
        `;

        // Add change listeners for inline updates
        row.querySelectorAll("input").forEach(input => {
            input.addEventListener("change", async () => {
                const id = input.dataset.id;
                const field = input.dataset.field;
                let value = input.value;
                if (field === "price") value = parseFloat(value);

                try {
                    await fetch(`${API_URL}/${id}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ [field]: value })
                    });
                    input.style.transition = "background-color 0.3s ease";
                    input.style.backgroundColor = "#d4edda"; // light green
                    setTimeout(() => {
                        input.style.backgroundColor = ""; // revert to default
                    }, 800);

                    console.log(`✅ Updated ${field} for product ${id}`);
                } catch (error) {
                    input.style.transition = "background-color 0.3s ease";
                    input.style.backgroundColor = "#f8d7da"; // light red
                    setTimeout(() => {
                        input.style.backgroundColor = "";
                    }, 800);

                    console.error("❌ Error updating product:", error);
                }
            });
        });

        return row;
    }

        // Fetch and display all products
        async function fetchProducts() {
            try {
                const response = await fetch(API_URL, { method: "GET", headers: { "Content-Type": "application/json" } });
                const products = await response.json();
                console.log("_------->",products)
                const list = document.getElementById("productList");
                list.innerHTML = ""; // Clear table body

                products.forEach(p => list.appendChild(createEditableRow(p)));
            } catch (error) {
                console.error("❌ Error fetching products:", error);
            }
        }

        // Create new product
        async function createProduct() {
            const name = document.getElementById("name").value.trim();
            const price = parseFloat(document.getElementById("price").value);
            const description = document.getElementById("description").value.trim();

            if (!name || isNaN(price)) {
                alert("Please enter valid Name and Price");
                return;
            }

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, price, description })
                });
                const data = await response.json();

                alert(`✅ Product created with ID: ${data.id}`);

                // Clear input fields
                document.getElementById("name").value = "";
                document.getElementById("price").value = "";
                document.getElementById("description").value = "";

                // Refresh product list
                fetchProducts();
            } catch (error) {
                console.error("❌ Error creating product:", error);
                alert("❌ Failed to create product");
            }
        }

        async function deleteProduct(id) {
            if (!confirm("Are you sure you want to delete this product?")) return;

            try {
                await fetch(`${API_URL}/${id}`, { method: "DELETE" });
                fetchProducts(); // Refresh table
            } catch (error) {
                console.error("❌ Error deleting product:", error);
            }
        }

        // Load products on page load
        window.addEventListener('DOMContentLoaded', fetchProducts);
    </script>
</body>
</html>
